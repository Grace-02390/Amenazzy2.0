<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topitop - Productos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="icon" type="image/x-icon" href="./imgs/favico.png">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0e0e0; 
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden; 
            margin: 0;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #e0e0e0; 
            z-index: -1; 
        }

        .animate-modalFadeIn {
            animation: modalFadeIn 0.3s ease-out forwards;
        }

        .animate-modalZoomIn {
            animation: modalZoomIn 0.4s ease-out forwards;
        }

        .animate-modalFadeOut {
            animation: modalFadeOut 0.25s ease-in forwards;
        }

        .animate-modalZoomOut {
            animation: modalZoomOut 0.25s ease-in forwards;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(1.2); }
        }
        @keyframes fadeOut {
            0% { opacity: 0; transform: scale(0.5); }
            10% { opacity: 0.8; transform: scale(1); }
            90% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.5); }
        }

        @keyframes floatAndFade {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            80% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-110vh) translateX(var(--end-x)) rotate(var(--end-rotate));
                opacity: 0;
            }
        }

        @keyframes modalFadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        @keyframes modalZoomIn {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes modalFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes modalZoomOut {
        from {
            opacity: 1;
            transform: scale(1);
        }
        to {
            opacity: 0;
            transform: scale(0.9);
        }
        }

        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }
            nav > div:first-child {
                margin-bottom: 0.5rem;
            }
            nav > div:last-child {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                gap: 0.5rem;
            }
            nav a {
                width: 100%;
                text-align: center;
                padding: 0.5rem 0;
            }
            main h2 {
                font-size: 1.75rem;
                margin-bottom: 1.5rem;
            }
            .filter-section form {
                grid-template-columns: 1fr;
            }
            .filter-section .md\:col-span-4 {
                flex-direction: column;
                gap: 0.5rem;
                align-items: center;
            }
            .filter-section button,
            .filter-section a.ml-4 {
                width: 100%;
            }
            .filter-section a.ml-4 {
                margin-left: 0;
            }
            .product-card .p-5 {
                padding: 1rem;
            }
            #productDetailsModal > div {
                flex-direction: column;
                padding: 1.5rem;
            }
            #productDetailsModal .md\:w-1\/2 {
                width: 100%;
            }
            #productDetailsModal h3 {
                font-size: 2rem;
            }
            #productDetailsModal img {
                height: 10rem;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">
<header>
  <div class="w-full max-w-7xl mx-auto py-3">
    <div class="flex justify-between gap-8 items-center">
      <div>
        <a href="/bienvenida">
          <img src="https://cdn.brandfetch.io/idQpqgVquN/w/122/h/47/theme/dark/logo.png?c=1dxbfHSJFAPEGdCLU4o5B" 
               alt="Topitop logo" 
               class="h-8 hover:opacity-90 transition duration-300" />
        </a>
      </div>

      <div class="flex items-center gap-8">
        <nav class="hidden lg:flex gap-8 text-black text-base">
          <a href="/bienvenida" class="hover:underline text-black">Inicio</a>
          <a href="/nosotros" class="hover:underline text-black">Nosotros</a>
          <a href="/productos" class="hover:underline text-black">Productos</a>
        </nav>

        <span class="hidden lg:block text-black">|</span>

        <div class="flex gap-4 items-center relative">
          <a href="/carrito" class="relative" title="Ver Carrito">
            <i class="flex items-center justify-center bg-black text-white rounded-full w-[35px] h-[35px] bi bi-bag"></i>
            <span th:if="${carritoCount > 0}"
                  th:text="${carritoCount}"
                  class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">
            </span>
          </a>
          <div class="relative">
            <button id="userDropdown" class="flex items-center justify-center w-[35px] h-[35px] bg-blue-600 hover:bg-blue-700 text-white rounded-full transition duration-200" title="Men√∫ de Usuario">
              <i class="bi bi-person text-lg"></i>
            </button>
            <div id="dropdownMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden">
              <a href="/cliente/historial-boletas" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                üìã Historial de Boletas
              </a>
              <hr class="my-1">
              <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                üö™ Cerrar Sesi√≥n
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>



    <main class="flex-grow container mx-auto p-4 md:p-1">
        <h2 class="text-4xl font-bold text-gray-800 text-center mb-6 mt-5">Nuestra Colecci√≥n</h2>
        <div class="bg-white/95 backdrop-blur-sm shadow-xl border border-gray-300 rounded-xl px-8 py-6 w-full max-w-7xl mx-auto mb-10 text-gray-900">
            <h3 class="text-2xl font-medium text-gray-800 mb-6 tracking-tight flex items-center gap-2">
            Filtrar B√∫squeda
            </h3>

            <form th:action="@{/productos}" method="get" class="flex flex-wrap md:flex-nowrap gap-6 items-end justify-between">
                <div class="flex flex-col w-full md:w-1/5">
                    <label for="categoria" class="text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>
                    <select id="categoria" name="categoria"
                        class="bg-[#dadada] text-[#525252] px-4 py-2 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-[#640700]"
                        style="text-align-last: left;">
                        <option value="">Todas</option>
                        <option th:each="cat : ${categorias}" th:value="${cat}" th:text="${cat}" th:selected="${cat == selectedCategoria}"></option>
                    </select>
                </div>

                <div class="flex flex-col w-full md:w-1/5">
                    <label for="genero" class="text-sm font-medium text-gray-700 mb-1">G√©nero</label>
                    <select id="genero" name="genero"
                        class="bg-[#dadada] text-[#525252] px-4 py-2 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-[#640700]"
                        style="text-align-last: left;">
                        <option value="">Todos</option>
                        <option value="hombre" th:selected="${'hombre' == selectedGenero}">Hombre</option>
                        <option value="mujer" th:selected="${'mujer' == selectedGenero}">Mujer</option>
                        <option value="ni√±o" th:selected="${'ni√±o' == selectedGenero}">Ni√±o</option>
                        <option value="ni√±a" th:selected="${'ni√±a' == selectedGenero}">Ni√±a</option>
                    </select>
                </div>

                <div class="flex flex-col w-full md:w-1/5">
                    <label for="talla" class="text-sm font-medium text-gray-700 mb-1">Talla</label>
                    <select id="talla" name="talla"
                        class="bg-[#dadada] text-[#525252] px-3 py-2 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-[#640700]"
                        style="text-align-last: left;">
                        <option value="">Todas</option>
                        <option value="S" th:selected="${'S' == selectedTalla}">S</option>
                        <option value="M" th:selected="${'M' == selectedTalla}">M</option>
                        <option value="L" th:selected="${'L' == selectedTalla}">L</option>
                        <option value="XL" th:selected="${'XL' == selectedTalla}">XL</option>
                    </select>
                </div>

                <div class="flex flex-col w-full md:w-1/5">
                    <label for="search" class="text-sm font-medium text-gray-700 mb-1">Buscar</label>
                    <input type="text" id="search" name="search" th:value="${searchTerm}" placeholder="Nombre o descripci√≥n..."
                        class="bg-[#dadada] text-[#525252] px-4 py-2 rounded-md text-base focus:outline-none focus:ring-2 focus:ring-[#640700] placeholder:text-[#888888]" />
                    </div>
                    <div class="flex gap-3 w-full md:w-auto justify-center md:justify-end">
                    <button type="submit" class="w-10 h-10 flex items-center justify-center rounded-full bg-black hover:bg-neutral-800 text-white transition" title="Aplicar Filtros">
                        <i class="fas fa-filter text-lg"></i>
                    </button>
                    <a th:href="@{/productos}" class="w-10 h-10 flex items-center justify-center rounded-full bg-[#7a1a1a] hover:bg-[#a31919] text-white transition" title="Limpiar Filtros">
                        <i class="fas fa-times text-lg"></i>
                    </a>
                </div>
            </form>
        </div>


        <div th:if="${#lists.isEmpty(productos)}" class="text-center text-gray-600 text-xl py-10 product-grid-message">
            No se encontraron productos con los criterios de b√∫squeda.
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 px-6 lg:px-16">
            <div th:each="producto : ${productos}" 
                class="bg-white rounded-2xl shadow-sm hover:shadow-md border border-gray-100 max-w-xs w-full mx-auto transition-transform duration-300 hover:scale-[1.02]">

                <img th:src="${producto.imagenUrl != null and producto.imagenUrl != '' ? producto.imagenUrl : 'https://placehold.co/400x300/eeeeee/000000?text=Producto'}"
                    alt="Imagen del producto"
                    class="w-full h-56 object-cover object-center rounded-t-2xl">

                <div class="p-4 space-y-2 text-left">
                <!-- Nombre y precio (misma fila) -->
                <div class="flex items-center justify-between">
                    <h3 class="text-sm font-medium text-gray-900 truncate" th:text="${producto.nombre}">Nombre del Producto</h3>
                    <div class="text-sm text-right">
                    <span th:if="${producto.descuento > 0}" 
                            class="text-red-600 font-semibold block"
                            th:text="'S/.' + ${#numbers.formatDecimal(producto.precio * (1 - producto.descuento/100), 1, 2)}">
                        S/.XX.XX
                    </span>
                    <span th:unless="${producto.descuento > 0}" 
                            class="text-gray-700 font-bold block"
                            th:text="'S/.' + ${#numbers.formatDecimal(producto.precio, 1, 2)}">
                        S/.XX.XX
                    </span>
                    </div>
                </div>

                <!-- Categor√≠a - G√©nero - Talla -->
                <p class="text-xs text-gray-600 leading-tight" th:text="${producto.categoria} + ' - ' + ${producto.genero} + ' - Talla: ' + ${producto.talla}">
                    Categor√≠a - G√©nero - Talla
                </p>

                <!-- Precio original y badge de descuento -->
                <div th:if="${producto.descuento > 0}" class="flex items-center gap-2 text-xs">
                    <span class="line-through text-gray-400"
                        th:text="'S/.' + ${#numbers.formatDecimal(producto.precio, 1, 2)}">
                    S/.XX.XX
                    </span>
                    <span class="bg-red-100 text-red-600 font-medium px-2 py-0.5 rounded-full"
                        th:text="${#numbers.formatDecimal(producto.descuento, 0, 0) + '% OFF'}">
                    XX% OFF
                    </span>
                </div>

                <!-- Stock -->
                <p th:classappend="${producto.stock > 0 ? 'text-green-600' : 'text-red-600'}"
                    class="text-xs font-medium">
                    Stock: <span th:text="${producto.stock}"></span>
                    <span th:if="${producto.stock == 0}" class="ml-1">(Agotado) üì¶</span>
                </p>

                <!-- Botones -->
                <div class="flex flex-col gap-2 mt-3">
                    <button th:if="${producto.stock > 0}" 
                            onclick="addToCart(this)"
                            th:data-producto-id="${producto.id}"
                            class="bg-green-600 hover:bg-green-700 text-white font-medium py-1.5 px-4 rounded-lg text-sm transition">
                    Agregar al Carrito
                    </button>

                    <button th:if="${producto.stock == 0}" 
                            class="bg-gray-200 text-gray-500 font-medium py-1.5 px-4 rounded-lg text-sm cursor-not-allowed opacity-70"
                            disabled>
                    Agotado üö´
                    </button>

                    <button onclick="showProductDetailsModal(this)"
                            th:data-id="${producto.id}"
                            th:data-nombre="${producto.nombre}"
                            th:data-descripcion="${producto.descripcion}"
                            th:data-categoria="${producto.categoria}"
                            th:data-genero="${producto.genero}"
                            th:data-talla="${producto.talla}"
                            th:data-precio="${producto.precio}"
                            th:data-descuento="${producto.descuento}"
                            th:data-stock="${producto.stock}"
                            th:data-imagenurl="${producto.imagenUrl != null ? producto.imagenUrl : ''}"
                            th:data-tela="${producto.tela}"
                            class="bg-red-700 hover:bg-red-800 text-white font-medium py-1.5 px-4 rounded-lg text-sm transition">
                            Ver m√°s detalles
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div id="productDetailsModal" class="fixed inset-0 bg-gray-200/60 backdrop-blur-sm flex items-center justify-center z-50 hidden animate-modalFadeIn">
        <div class="bg-white/95 rounded-2xl shadow-2xl border border-gray-200 max-w-3xl w-full mx-4 p-8 relative animate-modalZoomIn">
            
            <button onclick="hideProductDetailsModal()" 
                    class="absolute top-4 right-4 text-gray-500 hover:text-red-800 text-2xl font-bold transition duration-200">
            &times;
            </button>

            <div class="flex flex-col md:flex-row gap-8 text-gray-800">
                <div class="md:w-1/2">
                    <img id="modal-imagen" 
                        src="https://placehold.co/400x300/eeeeee/000000?text=Producto" 
                        alt="Imagen del producto" 
                        class="w-full h-auto rounded-xl border border-gray-300 shadow-sm object-cover">
                </div>

                <div class="md:w-1/2 space-y-3 text-sm">
                    <h3 id="modal-nombre" class="text-2xl font-bold text-gray-900 mb-2 tracking-tight">
                    Nombre del Producto
                    </h3>

                    <p><strong class="text-gray-700">Categor√≠a:</strong> <span id="modal-categoria"></span></p>
                    <p><strong class="text-gray-700">G√©nero:</strong> <span id="modal-genero"></span></p>
                    <p><strong class="text-gray-700">Talla:</strong> <span id="modal-talla"></span></p>
                    <p><strong class="text-gray-700">Tela:</strong> <span id="modal-tela"></span></p>

                    <p id="modal-descripcion" class="text-[15px] text-gray-700 leading-relaxed mt-2">
                    Descripci√≥n detallada del producto.
                    </p>

                    <div class="flex items-center space-x-3 mt-3">
                    <span id="modal-precio-descuento" 
                            class="text-red-600 font-bold text-xl hidden">
                    </span>
                    <span id="modal-precio-original" 
                            class="text-blue-700 font-bold text-xl">
                    </span>
                    <span id="modal-descuento-badge" 
                            class="bg-red-100 text-red-700 text-xs font-semibold px-2.5 py-0.5 rounded-full hidden">
                    </span>
                    </div>
                    <p id="modal-stock" class="text-sm font-medium mt-2 text-gray-700"></p>
                </div>
            </div>
        </div>
    </div>


<div id="messageModal" class="fixed inset-0 bg-white/70 backdrop-blur-md flex items-center justify-center z-50 hidden animate-modalFadeIn">
  <div class="bg-white/90 border border-gray-300 p-6 rounded-2xl shadow-xl text-center max-w-sm w-full mx-4 animate-modalZoomIn">
    <p id="messageText" class="text-base md:text-lg font-semibold text-gray-800 mb-5">
    </p>
    <button onclick="hideMessageModal()" 
            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
      Cerrar
    </button>
  </div>
</div>



<footer class="bg-white border-t border-gray-200 text-gray-700 text-sm mt-16">
  <div class="max-w-7xl mx-auto px-6 py-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8">
    <div>
      <h5 class="text-base font-semibold text-gray-900 mb-3">Topitop</h5>
      <p class="text-sm leading-relaxed">Ropa de moda para toda la familia con estilo, comodidad y calidad.</p>
    </div>
    <div>
      <h5 class="text-base font-semibold text-gray-900 mb-3">Enlaces √∫tiles</h5>
      <ul class="space-y-2">
        <li><a href="/" class="hover:underline">Inicio</a></li>
        <li><a href="/productos-publicos" class="hover:underline">Productos</a></li>
        <li><a href="/login" class="hover:underline">Iniciar sesi√≥n</a></li>
        <li><a href="/registro" class="hover:underline">Registrarse</a></li>
      </ul>
    </div>
    <div>
      <h5 class="text-base font-semibold text-gray-900 mb-3">Cont√°ctanos</h5>
      <ul class="space-y-2">
        <li>üìç Av. Cutervo 123, Ica, Per√∫</li>
        <li>üìû +51 987 654 321</li>
        <li>‚úâÔ∏è soporte_ica@topitop.com</li>
      </ul>
    </div>
    <div>
      <h5 class="text-base font-semibold text-gray-900 mb-3">S√≠guenos</h5>
      <div class="flex space-x-4">
        <a href="#" class="hover:text-blue-500"><i class="fab fa-facebook-f"></i></a>
        <a href="#" class="hover:text-pink-500"><i class="fab fa-instagram"></i></a>
        <a href="#" class="hover:text-blue-400"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </div>

  <div class="text-center text-gray-500 text-xs py-4 border-t border-gray-200">
    ¬© 2025 Topitop. Todos los derechos reservados.
  </div>
</footer>

<script>
    function showProductDetailsModal(button) {
        const modal = document.getElementById('productDetailsModal');

        document.getElementById('modal-nombre').innerText = button.dataset.nombre || 'N/A';
        document.getElementById('modal-descripcion').innerText = button.dataset.descripcion || 'Sin descripci√≥n disponible.';
        document.getElementById('modal-categoria').innerText = button.dataset.categoria || 'N/A';
        document.getElementById('modal-genero').innerText = button.dataset.genero || 'N/A';
        document.getElementById('modal-talla').innerText = button.dataset.talla || 'N/A';
        document.getElementById('modal-tela').innerText = button.dataset.tela || 'N/A';

        const precio = parseFloat(button.dataset.precio);
        const descuento = parseFloat(button.dataset.descuento);
        const precioOriginalSpan = document.getElementById('modal-precio-original');
        const precioDescuentoSpan = document.getElementById('modal-precio-descuento');
        const descuentoBadge = document.getElementById('modal-descuento-badge');

        precioOriginalSpan.classList.remove('line-through', 'text-gray-500', 'text-sm', 'text-blue-700', 'font-bold', 'text-xl', 'text-2xl');
        precioDescuentoSpan.classList.add('hidden');
        descuentoBadge.classList.add('hidden');

        if (descuento > 0) {
            const precioConDescuento = precio * (1 - descuento / 100);
            precioDescuentoSpan.innerText = `S/.${precioConDescuento.toFixed(2)}`;
            precioDescuentoSpan.classList.remove('hidden');
            precioOriginalSpan.classList.add('line-through', 'text-gray-500', 'text-sm');
            precioOriginalSpan.innerText = `S/.${precio.toFixed(2)}`;
            descuentoBadge.innerText = `${descuento.toFixed(0)}% OFF`;
            descuentoBadge.classList.remove('hidden');
        } else {
            precioOriginalSpan.classList.add('text-blue-700', 'font-bold', 'text-2xl'); 
            precioOriginalSpan.innerText = `S/.${precio.toFixed(2)}`;
        }

        const stock = parseInt(button.dataset.stock);
        const stockElement = document.getElementById('modal-stock');
        stockElement.innerText = `Stock: ${stock}`;
        stockElement.classList.remove('text-green-600', 'text-red-600');
        stockElement.classList.add(stock > 0 ? 'text-green-600' : 'text-red-600');
        if (stock === 0) {
            stockElement.innerText += ' (Agotado)';
        }

        const imagenUrl = button.dataset.imagenurl;
        document.getElementById('modal-imagen').src = (imagenUrl && imagenUrl !== 'null' && imagenUrl !== '') ? imagenUrl : 'https://placehold.co/400x300/242424/10B981?text=Producto';

        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.add('show'), 10); 
    }

    function hideProductDetailsModal() {
        const modal = document.getElementById('productDetailsModal');
        modal.classList.remove('show');
        modal.addEventListener('transitionend', function handler() {
            modal.classList.add('hidden');
            modal.removeEventListener('transitionend', handler);
        });
    }

    window.onclick = function(event) {
        const productModal = document.getElementById('productDetailsModal');
        const messageModal = document.getElementById('messageModal');
        if (event.target == productModal) {
            hideProductDetailsModal();
        }
        if (event.target == messageModal) {
            hideMessageModal();
        }
    }

    function showMessageModal(message, isSuccess = true) {
        const modal = document.getElementById('messageModal');
        const messageText = document.getElementById('messageText');
        messageText.innerText = message;
        messageText.classList.remove('text-green-700', 'text-red-700');
        messageText.classList.add(isSuccess ? 'text-gray-800' : 'text-red-700');

        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.add('show'), 10);
    }

    function hideMessageModal() {
        const modal = document.getElementById('messageModal');
        modal.classList.remove('show');
        modal.addEventListener('transitionend', function handler() {
            modal.classList.add('hidden');
            modal.removeEventListener('transitionend', handler);
        });
    }

    async function addToCart(button) {
        const productoId = button.dataset.productoId;
        try {
            const response = await fetch('/carrito/agregar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productoId: productoId, cantidad: 1 })
            });

            if (response.ok) {
                const data = await response.json();
                showMessageModal(data.message, true);
                const carritoCountSpan = document.querySelector('nav .fa-shopping-cart + span');
                if (carritoCountSpan) {
                    carritoCountSpan.innerText = data.carritoCount;
                    if (data.carritoCount > 0) {
                        carritoCountSpan.classList.remove('hidden');
                    } else {
                        carritoCountSpan.classList.add('hidden');
                    }
                }
            } else {
                const errorData = await response.json();
                showMessageModal(errorData.message || 'Error al agregar producto al carrito.', false);
            }
        } catch (error) {
            console.error('Error al agregar al carrito:', error);
            showMessageModal('Error de conexi√≥n. Int√©ntalo de nuevo.', false);
        }
    }

    // User Dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
        const userDropdown = document.getElementById('userDropdown');
        const dropdownMenu = document.getElementById('dropdownMenu');

        if (userDropdown && dropdownMenu) {
            userDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!userDropdown.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.add('hidden');
                }
            });
        }
    });
</script>
</body>
</html>